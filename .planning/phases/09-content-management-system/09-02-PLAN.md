---
phase: 09-content-management-system
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/validate-data.ts
  - .github/workflows/validate-data.yml
  - package.json
autonomous: true

must_haves:
  truths:
    - "A validation script checks all JSON data files against Zod schemas"
    - "The validation script exits with code 1 on failure, code 0 on success"
    - "GitHub Actions runs validation on every PR that touches data files"
    - "Failed validation blocks the PR merge (via required status check)"
    - "Error messages are human-readable and pinpoint the exact problem"
  artifacts:
    - path: "scripts/validate-data.ts"
      provides: "CLI validation script for all JSON data files"
      min_lines: 40
    - path: ".github/workflows/validate-data.yml"
      provides: "CI workflow that runs validation on PRs touching data files"
      min_lines: 20
    - path: "package.json"
      provides: "validate:data script command"
      contains: "validate:data"
  key_links:
    - from: "scripts/validate-data.ts"
      to: "src/lib/schemas/index.ts"
      via: "imports all schemas"
      pattern: "from.*schemas"
    - from: "scripts/validate-data.ts"
      to: "src/lib/data/*.json"
      via: "imports all JSON files"
      pattern: "from.*\\.json"
    - from: ".github/workflows/validate-data.yml"
      to: "scripts/validate-data.ts"
      via: "pnpm validate:data command"
      pattern: "validate:data"
---

<objective>
Create the validation pipeline that prevents broken edits from reaching production.

Purpose: This is the critical safety net for non-technical editors. When a board member makes a JSON edit that would break the site (missing comma, invalid value, wrong structure), this pipeline catches it before the change goes live and shows a clear error message explaining what to fix.

Output: A validation script runnable locally and in CI, plus a GitHub Actions workflow that automatically validates data file changes on pull requests.
</objective>

<execution_context>
@C:/Users/sloeh/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/sloeh/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-content-management-system/09-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create validation script and package.json command</name>
  <files>
    scripts/validate-data.ts
    package.json
  </files>
  <action>
    Create `scripts/validate-data.ts` that:

    1. Imports all Zod schemas from `../src/lib/schemas/index.ts` (TeamsDataSchema, FeesDataSchema, OrganizationDataSchema, SponsorsDataSchema, HomeDataSchema, SpiritWearDataSchema, ContactDataSchema, ConductDataSchema).

    2. Imports all JSON files from `../src/lib/data/*.json` (teams.json, fees.json, organization.json, sponsors.json, home.json, spirit-wear.json, contact.json, conduct.json).

    3. Defines a `validateFile(filename, schema, data)` function that:
       - Calls `schema.parse(data)`
       - On success: prints "  [PASS] {filename}" and returns true
       - On failure: prints "  [FAIL] {filename}" followed by each Zod error formatted as "    Line path: {error.path.join('.')} - {error.message}", returns false

    4. Runs validation for all 8 files, collects results, prints summary.

    5. Exits with code 0 if all pass, code 1 if any fail.

    Note: This script will be run with `tsx` (TypeScript execution). Check if `tsx` is in devDependencies. If not, install it. Alternatively, use `npx tsx` which works without installation.

    Add to package.json scripts: `"validate:data": "npx tsx scripts/validate-data.ts"`

    The script must work BEFORE Plan 01 completes (it will fail because JSON files don't exist yet, but the script itself must be syntactically valid). The schemas and JSON files from Plan 01 will make it actually pass. This is fine because Plan 01 and 02 are in the same wave — they'll both be done before the validation is expected to work end-to-end.
  </action>
  <verify>
    Run `npx tsc --noEmit` to verify the script has no type errors (assuming schema files exist from Plan 01 — if running independently, verify the script file is syntactically valid TypeScript).
  </verify>
  <done>scripts/validate-data.ts exists with validation logic for all 8 data files. package.json has "validate:data" script. Script exits 0 on success, 1 on failure with descriptive error messages.</done>
</task>

<task type="auto">
  <name>Task 2: Create GitHub Actions validation workflow</name>
  <files>
    .github/workflows/validate-data.yml
  </files>
  <action>
    Create `.github/workflows/validate-data.yml` with:

    **Trigger:** On pull_request and push to main, only when files in `src/lib/data/**/*.json` or `src/lib/schemas/**/*.ts` change.

    **Job: validate**
    - runs-on: ubuntu-latest
    - Steps:
      1. Checkout code (actions/checkout@v4)
      2. Setup pnpm (pnpm/action-setup@v4, detect version from packageManager field or use version 10)
      3. Setup Node.js (actions/setup-node@v4, node-version: 20, cache: pnpm)
      4. Install dependencies: `pnpm install --frozen-lockfile`
      5. Run validation: `pnpm validate:data`
      6. Run type check: `pnpm tsc --noEmit`
      7. On failure, comment on PR using actions/github-script@v7 with a message explaining the validation failed and suggesting the user check error output above.

    The workflow name should be "Validate Data Files" — this is what appears in GitHub's PR checks UI and what the user will reference when setting up branch protection (documented in the Content Update Guide, Plan 03).

    Check package.json for a `packageManager` field. If it exists, pnpm/action-setup can auto-detect the version. If not, specify version explicitly.
  </action>
  <verify>
    Verify the YAML file is valid: check indentation, proper use of `on:` triggers, correct action versions. The workflow can't be tested locally but should be syntactically correct.
  </verify>
  <done>.github/workflows/validate-data.yml exists with PR-triggered validation that runs pnpm validate:data and tsc, with failure comments on PRs.</done>
</task>

</tasks>

<verification>
1. scripts/validate-data.ts exists and is valid TypeScript
2. .github/workflows/validate-data.yml exists with correct YAML structure
3. package.json contains "validate:data" script
4. After Plan 01 completes, `pnpm validate:data` exits with code 0 (all data valid)
</verification>

<success_criteria>
- Validation script validates all 8 JSON data files against their Zod schemas
- Script provides clear, actionable error messages on validation failure
- GitHub Actions workflow triggers on data file changes in PRs
- Failed validation is visible in PR checks UI
- pnpm validate:data command works locally for developers
</success_criteria>

<output>
After completion, create `.planning/phases/09-content-management-system/09-02-SUMMARY.md`
</output>
